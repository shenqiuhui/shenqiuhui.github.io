(function(p,C){var q=C.body,k=C.querySelector.bind(C),r=C.querySelectorAll.bind(C),x=k("html"),t=k("#gotop"),u=k("#gobottom"),a=k("#menu"),z=k("#header"),y=k("#mask"),v=k("#menu-toggle"),o=k("#menu-off"),h=k("#loading"),l=p.requestAnimationFrame,s=200/(1000/60),A=Array.prototype.forEach,n=("ontouchstart" in p&&/Mobile|Android|iOS|iPhone|iPad|iPod|Windows Phone|KFAPWI/i.test(navigator.userAgent))?"touchstart":"click",D=/micromessenger/i.test(navigator.userAgent),f=function(){},m=function(w){var d=w.offsetLeft,F=w.offsetTop;if(w.offsetParent){var E=arguments.callee(w.offsetParent);d+=E.x;F+=E.y}return{x:d,y:F}},B=function(){return C.documentElement.scrollTop||C.body.scrollTop};var c={goTop:function(d){var E=B();var w=arguments.length>2?arguments[1]:Math.abs(E-d)/s;if(E&&E>d){p.scrollTo(0,Math.max(E-w,0));l(arguments.callee.bind(this,d,w))}else{if(d&&E<d){p.scrollTo(0,Math.min(E+w,d));l(arguments.callee.bind(this,d,w))}else{this.toc.actived(d)}}},goBottom:function(d){var E=B();var w=arguments.length>2?arguments[1]:Math.abs(E-d)/s;if(E&&E>d){p.scrollTo(0,Math.max(E-w,0));l(arguments.callee.bind(this,d,w))}else{if(d&&E<d-1){p.scrollTo(0,Math.min(E+w,d));l(arguments.callee.bind(this,d,w))}else{this.toc.actived(d)}}},toggleGotop:function(d){if(d>p.innerHeight/2){t.classList.add("in")}else{t.classList.remove("in")}},toggleGoBottom:function(d){if(d<getScrollHeight(C)-getWindowHeight(C)-p.innerHeight/2){u.classList.add("in")}else{u.classList.remove("in")}},toggleMenu:function(w){var d=k("#main");if(w){a.classList.remove("hide");if(p.innerWidth<1241){y.classList.add("in");a.classList.add("show");if(D){var E=B();d.classList.add("lock");d.scrollTop=E}else{x.classList.add("lock")}}}else{a.classList.remove("show");y.classList.remove("in");if(D){var E=d.scrollTop;d.classList.remove("lock");p.scrollTo(0,E)}else{x.classList.remove("lock")}}},fixedHeader:function(d){if(d>z.clientHeight){z.classList.add("fixed")}else{z.classList.remove("fixed")}},toc:(function(){var I=k("#post-toc");if(!I||!I.children.length){return{fixed:f,actived:f}}var G=k(".post-header").clientHeight,E=z.clientHeight,F=k("#post-content").querySelectorAll("h1, h2, h3, h4, h5, h6");I.querySelector('a[href="#'+F[0].id+'"]').parentNode.classList.add("active");var H=I.querySelectorAll(".post-toc-child");for(i=0,len=H.length;i<len;i++){H[i].classList.add("post-toc-shrink")}var w=I.querySelector('a[href="#'+F[0].id+'"]').nextElementSibling;if(w){w.classList.add("post-toc-expand");w.classList.remove("post-toc-shrink")}I.classList.remove("post-toc-shrink");var d=function(M,K){M.classList.remove("active");K.classList.add("active");var J=K.parentElement.querySelectorAll(".post-toc-child");for(j=0,len1=J.length;j<len1;j++){J[j].classList.remove("post-toc-expand");J[j].classList.add("post-toc-shrink")}var L=K.querySelector(".post-toc-child");if(L){L.classList.remove("post-toc-shrink");L.classList.add("post-toc-expand")}};return{fixed:function(J){J>=G-E?I.classList.add("fixed"):I.classList.remove("fixed")},actived:function(L){for(i=0,len=F.length;i<len;i++){if(L>m(F[i]).y-E-5){var K=I.querySelector("li.active");var J=I.querySelector('a[href="#'+F[i].id+'"]').parentNode;d(K,J)}}if(L<m(F[0]).y){d(I.querySelector("li.active"),I.querySelector('a[href="#'+F[0].id+'"]').parentNode)}}}})(),hideOnMask:[],modal:function(d){this.$modal=k(d);this.$off=this.$modal.querySelector(".close");var w=this;this.show=function(){y.classList.add("in");w.$modal.classList.add("ready");setTimeout(function(){w.$modal.classList.add("in")},0)};this.onHide=f;this.hide=function(){w.onHide();y.classList.remove("in");w.$modal.classList.remove("in");setTimeout(function(){w.$modal.classList.remove("ready")},300)};this.toggle=function(){return w.$modal.classList.contains("in")?w.hide():w.show()};c.hideOnMask.push(this.hide);this.$off&&this.$off.addEventListener(n,this.hide)},share:function(){var w=k("#pageShare"),E=k("#shareFab");var d=new this.modal("#globalShare");k("#menuShare").addEventListener(n,d.toggle);if(E){E.addEventListener(n,function(){w.classList.toggle("in")},false);C.addEventListener(n,function(G){!E.contains(G.target)&&w.classList.remove("in")},false)}var F=new this.modal("#wxShare");F.onHide=d.hide;A.call(r(".wxFab"),function(G){G.addEventListener(n,F.toggle)})},search:function(){var d=k("#search-wrap");function w(){d.classList.toggle("in")}k("#search").addEventListener(n,w)},reward:function(){var w=new this.modal("#reward");k("#rewardBtn").addEventListener(n,w.toggle);var E=k("#rewardToggle");var d=k("#rewardCode");if(E){E.addEventListener("change",function(){d.src=this.checked?this.dataset.alipay:this.dataset.wechat})}},waterfall:function(){if(p.innerWidth<760){return}A.call(r(".waterfall"),function(w){var E=w.querySelectorAll(".waterfall-item");var d=[0,0];A.call(E,function(G){var F=d[0]<=d[1]?0:1;G.style.cssText="top:"+d[F]+"px;left:"+(F>0?"50%":0);d[F]+=G.offsetHeight});w.style.height=Math.max(d[0],d[1])+"px";w.classList.add("in")})},tabBar:function(d){d.parentNode.parentNode.classList.toggle("expand")},page:(function(){var d=r(".fade, .fade-scale");var w=false;return{loaded:function(){A.call(d,function(E){E.classList.add("in")});w=true},unload:function(){A.call(d,function(E){E.classList.remove("in")});w=false},visible:w}})(),lightbox:(function(){function d(F){this.$img=F.querySelector("img");this.$overlay=F.querySelector("overlay");this.margin=40;this.title=this.$img.title||this.$img.alt||"";this.isZoom=false;var I,w,G,E,H;this.calcRect=function(){E=q.clientWidth;H=q.clientHeight;var N=H-this.margin*2;var M=I;var R=w;var P=this.margin;var L=0;var K=M>E?E/M:1;var O=R>N?N/R:1;var Q=Math.min(K,O);M=M*Q;R=R*Q;return{w:M,h:R,t:(H-R)/2-G.top,l:(E-M)/2-G.left+this.$img.offsetLeft}};this.setImgRect=function(K){this.$img.style.cssText="width: "+K.w+"px; max-width: "+K.w+"px; height:"+K.h+"px; top: "+K.t+"px; left: "+K.l+"px"};this.setFrom=function(){this.setImgRect({w:G.width,h:G.height,t:0,l:(F.offsetWidth-G.width)/2})};this.setTo=function(){this.setImgRect(this.calcRect())};this.addTitle=function(){if(!this.title){return}this.$caption=C.createElement("div");this.$caption.innerHTML=this.title;this.$caption.className="overlay-title";F.appendChild(this.$caption)};this.removeTitle=function(){this.$caption&&F.removeChild(this.$caption)};var J=this;this.zoomIn=function(){I=this.$img.naturalWidth||this.$img.width;w=this.$img.naturalHeight||this.$img.height;G=this.$img.getBoundingClientRect();F.style.height=G.height+"px";F.classList.add("ready");this.setFrom();this.addTitle();this.$img.classList.add("zoom-in");setTimeout(function(){F.classList.add("active");J.setTo();J.isZoom=true},0)};this.zoomOut=function(){F.classList.remove("active");this.$img.classList.add("zoom-in");this.setFrom();setTimeout(function(){J.isZoom=false;J.$img.classList.remove("zoom-in");J.$img.style.cssText="";J.removeTitle();F.classList.remove("ready");F.removeAttribute("style")},300)};F.addEventListener("click",function(K){J.isZoom?J.zoomOut():K.target.tagName==="IMG"&&J.zoomIn()});C.addEventListener("scroll",function(){J.isZoom&&J.zoomOut()});p.addEventListener("resize",function(){J.isZoom&&J.zoomOut()})}A.call(r(".img-lightbox"),function(w){new d(w)})})(),loadScript:function(d){d.forEach(function(E){var w=C.createElement("script");w.src=E;w.async=true;q.appendChild(w)})}};p.addEventListener("load",function(){h.classList.remove("active");c.page.loaded();p.lazyScripts&&p.lazyScripts.length&&c.loadScript(p.lazyScripts)});p.addEventListener("DOMContentLoaded",function(){c.waterfall();var d=B();c.toc.fixed(d);c.toc.actived(d);c.page.loaded()});var g=false;var e=k('a[href^="mailto"]');if(e){e.addEventListener(n,function(){g=true})}p.addEventListener("beforeunload",function(d){if(!g){c.page.unload()}else{g=false}});p.addEventListener("pageshow",function(){!c.page.visible&&c.page.loaded()});p.addEventListener("resize",function(){p.BLOG.even=n="ontouchstart" in p?"touchstart":"click";c.toggleMenu();c.waterfall()});t.addEventListener(n,function(){l(c.goTop.bind(c,0))},false);u.addEventListener(n,function(){if(C.getElementById("comments")){l(c.goBottom.bind(c,Math.min(getScrollHeight(C)-getWindowHeight(C),C.getElementById("comments").offsetTop)))}else{l(c.goBottom.bind(c,getScrollHeight(C)-getWindowHeight(C)))}},false);v.addEventListener(n,function(d){c.toggleMenu(true);d.preventDefault()},false);o.addEventListener(n,function(){a.classList.add("hide")},false);y.addEventListener(n,function(d){c.toggleMenu();c.hideOnMask.forEach(function(w){w()});d.preventDefault()},false);C.addEventListener("scroll",function(){var d=B();c.toggleGotop(d);c.toggleGoBottom(d);c.fixedHeader(d);c.toc.fixed(d);c.toc.actived(d)},false);if(p.BLOG.SHARE){c.share()}if(p.BLOG.REWARD){c.reward()}c.noop=f;c.even=n;c.$=k;c.$$=r;var b=B();c.toggleGotop(b);c.toggleGoBottom(b);Object.keys(c).reduce(function(d,w){d[w]=c[w];return d},p.BLOG);if(p.Waves){Waves.init();Waves.attach(".global-share li",["waves-block"]);Waves.attach(".article-tag-list-link, #page-nav a, #page-nav span",["waves-button"])}else{console.error("Waves loading failed.")}})(window,document);function getScrollHeight(a){var c=0,d=0,b=0;if(a.body){d=a.body.scrollHeight}if(a.documentElement){b=a.documentElement.scrollHeight}c=(d-b>0)?d:b;return c}function getWindowHeight(a){var b=0;if(a.compatMode=="CSS1Compat"){b=a.documentElement.clientHeight}else{b=a.body.clientHeight}return b};
